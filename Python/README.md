# Experiments on Python clone pairs
## Introduction
This folder contains all codes needed to run our experiments on Python clone pairs, data we did the experiments on and results we got from the experiments running on Python clone pairs. In data folder, the Filtered Python Codes contains all clone pairs filtered with both methods less than 10 lines and Sampled Python Codes contains 100 clone pairs that we randomly sampled from the filtered python codes. The humanIntuition.csv is human labeled. The first column is filenamesn second column is the line number and the third column are human label. The label can be -1 for non-core statements, 0 for unsure and 1 for core statements. <br/>
The codes and results will be introduced in the following sections. 
## Random Sampler
To sample the clone pairs from our dataset, we need to copy the [data/Filtered Python Codes](data%2FFiltered%20Python%20Codes) and paste it in [code/Sample](code%2FSample) folder and run the following commands:
```
cd code/Sample
javac PythonFilesRandomSampler.java 
java PythonFilesRandomSampler
```
## Wheat&Culprit Detection
The code for wheat&culprit detection are in folder [code/Wheat&Culprit](code%2FWheat%26Culprit). The dataset we ran the experiments on are [data/Filtered Python Codes](data%2FFiltered%20Python%20Codes). The results of the wheat&culprit detection are in [result/wheat&culprit](results%2Fwheat%26culprit). <br/>
Download mymodel.bin and put it in the folder [code/Wheat&Culprit](code%2FWheat%26Culprit). <br/>
To run the experiment, you need to put the [data/Filtered Python Codes](data%2FFiltered%20Python%20Codes) under [code/Wheat&Culprit](code%2FWheat%26Culprit) folder and run the following command:
```
cd code/Wheat&Culprit
python Mutationcodebertm1.py
```
After running above command, result_culprit_m2.csv and result_wheat_m2.csv, ,which contain the resuls of wheats or culprits detection of methods 2 of all clone pairs, will be generated in the same folder. 

```
python Mutationcodebertm2.py
```
After running above command, prediction_result.csv will be generated. prediction_result.csv contains prediction results of codeBERT for all clone pairs. 

## SHAP values
The code of finding shap values for each statement are in [code/shap](code%2Fshap). The dataset we ran the experiments on are [data/Sampled Python Codes](data%2FSampled%20Python%20Codes). The results of shap values are in [result/shap](results%2Fshap). <br/> 
Download mymodel.bin and put it in the folder [code/shap](code%2Fshap). <br/>
To run the experiment, you need to put the [data/Sampled Python Codes](data%2FSampled%20Python%20Codes) under [code/shap](code%2Fshap) folder and run the following command:
```
cd code/shap
python shapvaluesm1writetocsv.py
python shapvaluesm2writetocsv.py
```
After running above commands, sampledclonefileshaplogm1.csv and sampledm2permuteshaplog.csv, which contain shap values of all statements of method 1 and method 2 respectively, will be generated. 

## Correlation
The code to find correlations between human&shap, human&culprit and human&wheat are in [code/Correlation](code%2FCorrelation), the dataset we ran the experiments on are [data/Sampled Python Codes](data%2FSampled%20Python%20Codes), [data/Filtered Python Codes](data%2FFiltered%20Python%20Codes) and [data/humanIntuition.csv](data%2FhumanIntuition.csv). The results of all correlations are inside the [results/Correlation&Intersection](results%2FCorrelation%26Intersection)<br/>

To run the experiments, we need to make sure that we put [data/Sampled Python Codes](data%2FSampled%20Python%20Codes), [data/Filtered Python Codes](data%2FFiltered%20Python%20Codes) and [data/humanIntuition.csv](data%2FhumanIntuition.csv) in the folder [code/Correlation](code%2FCorrelation). Then put correlation.py inside both Filtered Python Codes and Sampled Python Codes. Next, we need to put the results generated by the wheat&culprit detection result_culprit_m1.csv, result_culprit_m2.csv, result_wheat_m1.csv and result_wheat_m2.csv and results of shap values sampledclonefileshaplogm1.csv and sampledm2permuteshaplog.csv under the folder [Correlation](code%2FCorrelation). <br/>

Then run the following commands:

```
cd code/Correlation
python result_formatter.py
```
Then 4 formatted wheat&culprit detection results will be generated. After that, do following commands:

```
cd CorrelationFinder
javac M1HumanCulpritCorrelationFinder
javac M1HumanWheatCorrelationFinder
javac M1HumanShapCorrelationFinder
javac M2HumanCulpritCorrelationFinder
javac M2HumanWheatCorrelationFinder
javac M2HumanShapCorrelationFinder
java M1HumanCulpritCorrelationFinder
java M1HumanWheatCorrelationFinder
java M1HumanShapCorrelationFinder
java M2HumanCulpritCorrelationFinder
java M2HumanWheatCorrelationFinder
java M2HumanShapCorrelationFinder

```
Then just pasted results in [HumanAnalysis.xlsx](results%2FCorrelation%26Intersection%2FHumanAnalysis.xlsx) and do analysis

## Intersection

To find the intersection between human intuition and wheat&culprit or between human intuition and shap value. To facilitate 
the findings of intersections, we need to put the shap value and wheat&culprit results that we generated before and the humanIntuition.csv in the [code/Intersection](code%2FIntersection) and
run the following commands:

```
python result_human_formatter.py
javac ShapRankm1
javac ShapRankm2
java ShapRankm1
java ShapRankm2
```
Then copy the results and paste in a excel sheet to find the intersections. The results can be find in [results/FCorrelation&Intersection/HumanAnalysis.xlsx](results%2FCorrelation%26Intersection%2FHumanAnalysis.xlsx)